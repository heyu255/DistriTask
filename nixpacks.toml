[phases.setup]
nixPkgs = ["go"]

[phases.install]
cmds = ["go mod download"]

[phases.build]
# Build based on SERVICE_NAME environment variable
# Set SERVICE_NAME to: "manager", "dashboard", or "worker"
cmds = [
  "if [ \"$SERVICE_NAME\" = \"manager\" ]; then go build -o manager cmd/manager/main.go;",
  "elif [ \"$SERVICE_NAME\" = \"dashboard\" ]; then go build -o dashboard cmd/dashboard/main.go;",
  "elif [ \"$SERVICE_NAME\" = \"worker\" ]; then go build -o worker cmd/worker/main.go;",
  "else go build -o manager cmd/manager/main.go; fi"
]

[start]
cmd = "if [ \"$SERVICE_NAME\" = \"manager\" ]; then ./manager; elif [ \"$SERVICE_NAME\" = \"dashboard\" ]; then ./dashboard; elif [ \"$SERVICE_NAME\" = \"worker\" ]; then ./worker; else ./manager; fi"
